#macro(label $labeltext $labelColor $width $offset)
<svg-container><svg:svg xmlns:svg="http://www.w3.org/2000/svg" width="${width}px" height="17px">
    <svg:rect x="0" y="0" rx="3" ry="3" width="$width" height="17" style="fill:$labelColor.getBackground()" />
    <svg:text text-anchor="middle" alignment-baseline="central" fill="$labelColor.getForeground()">
        <svg:tspan x="$offset" y="12" font-weight="bold">$labelText</svg:tspan>
    </svg:text>
</svg:svg></svg-container>
#end
#macro (vulnerabilityOverview $id $title $vulnerabilities)
<table id="$id">
    <title>$title</title>
    <tgroup cols="6">
        <colspec colname="COLSPEC0" colnum="1" colwidth="24*" />
        <colspec colname="COLSPEC1" colnum="2" colwidth="8*" />
        <colspec colname="COLSPEC2" colnum="3" colwidth="8*" />
        <colspec colname="COLSPEC3" colnum="4" colwidth="8*" />
        <colspec colname="COLSPEC4" colnum="5" colwidth="40*" />
        <colspec colname="COLSPEC5" colnum="6" colwidth="12*" />
        <thead>
            <row>
                <entry colname="COLSPEC0" valign="top">Name</entry>
                <entry colname="COLSPEC1" valign="top">Score<sub>v2</sub></entry>
                <entry colname="COLSPEC2" valign="top">Score<sub>v3</sub></entry>
                <entry colname="COLSPEC3" valign="top">Score<sub>max</sub></entry>
                <entry colname="COLSPEC4" valign="top">Alerts / Notices / Updates</entry>
                <entry colname="COLSPEC5" valign="top">Severity</entry>
            </row>
        </thead>

        <tbody>
#foreach($vulnerability in $vulnerabilities)
            <row>
                <entry>
                    #if ($vulnerability.get("Product URIs"))<lines><line><i>$report.xmlEscapeString($vulnerability.get("Product URIs"))</i></line>
                        <line>#if ($vulnerabilityAdapter.hasDetails($vulnerability, $threshold))<xref href="tpc_inventory-vulnerability-details.dita#$vulnerability.get("Name")" type="topic"><codeph>$report.xmlEscapeString($vulnerability.get("Name"))</codeph></xref>#else<xref href="$vulnerability.get("Url")" type="html" scope="external"><codeph>$report.xmlEscapeString($vulnerability.get("Name"))</codeph></xref>#end</line></lines>
                    #else<lines><line>#if ($vulnerabilityAdapter.hasDetails($vulnerability, $threshold))<xref href="tpc_inventory-vulnerability-details.dita#$vulnerability.get("Name")" type="topic"><codeph>$report.xmlEscapeString($vulnerability.get("Name"))</codeph></xref>#else<xref href="$vulnerability.get("Url")" type="html" scope="external"><codeph>$report.xmlEscapeString($vulnerability.get("Name"))</codeph></xref>#end</line></lines>#end
                </entry>
                <entry>$report.xmlEscapeString($vulnerability.get("CVSS Unmodified Overall (v2)"))</entry>
                <entry>$report.xmlEscapeString($vulnerability.get("CVSS Unmodified Overall (v3)"))</entry>
                <entry>$report.xmlEscapeString($vulnerability.get("CVSS Unmodified Overall (max)"))</entry>
                <entry>$vulnerabilityAdapter.hyperlinkedAdvisories($vulnerabilityAdapter.getAdvisories($vulnerability))</entry>
                <entry>
#if ($vulnerability.get("CVSS Unmodified Severity (max)"))
                    #set($labelText=$vulnerabilityAdapter.modulateSeverityText($vulnerability.get("CVSS Unmodified Severity (max)")))
                    #set($labelColor=$vulnerabilityAdapter.getLabelColor($vulnerability.get("CVSS Unmodified Severity Color (max)")))
                    #label($labelText, $labelColor, 56, 28)
#else
                    &nbsp;
#end
                </entry>
            </row>
#end
        </tbody>
    </tgroup>
</table>
#end
#macro (advisoryOverview $id $title $advisories)
<table id="$id">
    <title>$title</title>
    <tgroup cols="4">
        <colspec colname="COLSPEC0" colnum="1" colwidth="20*" />
        <colspec colname="COLSPEC1" colnum="2" colwidth="56*" />
        <colspec colname="COLSPEC2" colnum="3" colwidth="12*" />
        <colspec colname="COLSPEC3" colnum="4" colwidth="12*" />
        <thead>
        <row>
            <entry colname="COLSPEC0" valign="top">Id</entry>
            <entry colname="COLSPEC1" valign="top">Summary</entry>
            <entry colname="COLSPEC2" valign="top">Create Date</entry>
            <entry colname="COLSPEC3" valign="top">Update Date</entry>
        </row>
        </thead>
        <tbody>
#foreach($advisory in $advisories)
            <row>
                <entry>$vulnerabilityAdapter.hyperlinkedAdvisory($advisory)</entry>
                <entry>$report.xmlEscapePreformattedContentString($advisory.summary)</entry>
                <entry>$report.xmlEscapeString($advisory.createDate)</entry>
                <entry>$report.xmlEscapeString($advisory.updateDate)</entry>
            </row>
#end
        </tbody>
    </tgroup>
</table>
#end
#macro (referenceTable $id $title $vulnerability)
<table id="$id">
    <title>$title</title>
    <tgroup cols="2">
        <colspec colname="COLSPEC0" colnum="1" colwidth="30*" />
        <colspec colname="COLSPEC1" colnum="2" colwidth="80*" />
        <thead>
        <row>
            <entry colname="COLSPEC0" valign="top">Target</entry>
            <entry colname="COLSPEC1" valign="top">Hyperlink</entry>
        </row>
        </thead>
        <tbody>
#if ($vulnerability.get("Source").equalsIgnoreCase("NVD"))
            <row>
                <entry>NVD</entry>
                <entry><xref href="$vulnerability.get("Url")" type="html" scope="external"/></entry>
            </row>
            <row>
                <entry>MITRE</entry>
                <entry><xref href="https://www.cve.org/CVERecord?id=$vulnerabilityName" type="html" scope="external" /></entry>
            </row>
            <row>
                <entry>CVE Details</entry>
                <entry><xref href="https://www.cvedetails.com/cve/$vulnerabilityName" type="html" scope="external" /></entry>
            </row>
#else
            <row>
                <entry></entry>
                <entry><xref href="$report.xmlEscapePreformattedContentString($vulnerability.get("Url"))" type="html" scope="external" /></entry>
            </row>
#end
        </tbody>
    </tgroup>
</table>
#end
#macro (severityDetails $id $title $vulnerability)
<table id="$id">
    <title>$title</title>
    <tgroup cols="4">
        <colspec colname="COLSPEC0" colnum="1" colwidth="10*" />
        <colspec colname="COLSPEC1" colnum="2" colwidth="8*" />
        <colspec colname="COLSPEC2" colnum="3" colwidth="70*" />
        <colspec colname="COLSPEC3" colnum="4" colwidth="12**" />
        <thead>
        <row>
            <entry colname="COLSPEC0" valign="top">Scheme</entry>
            <entry colname="COLSPEC1" valign="top">Overall</entry>
            <entry colname="COLSPEC2" valign="top">CVSS Vector</entry>
            <entry colname="COLSPEC3" valign="top">Severity</entry>
        </row>
        </thead>
        <tbody>
            <row>
                <entry>CVSS v2.0</entry>
                <entry>$report.xmlEscapeString($vulnerability.get("CVSS Unmodified Overall (v2)"))</entry>
                <entry><codeph>$report.xmlEscapePreformattedContentString($vulnerability.get("CVSS Vector (v2)"))</codeph></entry>
                <entry>
#if ($vulnerability.get("CVSS Unmodified Severity (v2)"))
                    #set($labelText=$vulnerability.get("CVSS Unmodified Severity (v2)"))
                    #set($labelColor=$vulnerabilityAdapter.getLabelColor($vulnerability.get("CVSS Unmodified Severity Color (v2)")))
                    #label($labelText, $labelColor, 56, 28)
#else
                    &nbsp;
#end
                </entry>
            </row>
            <row>
                <entry>CVSS v3.x</entry>
                <entry>$report.xmlEscapeString($vulnerability.get("CVSS Unmodified Overall (v3)"))</entry>
                <entry><codeph>$report.xmlEscapePreformattedContentString($vulnerability.get("CVSS Vector (v3)"))</codeph></entry>
                <entry>
#if ($vulnerability.get("CVSS Unmodified Severity (v3)"))
                    #set($labelText=$vulnerability.get("CVSS Unmodified Severity (v3)"))
                    #set($labelColor=$vulnerabilityAdapter.getLabelColor($vulnerability.get("CVSS Unmodified Severity Color (v3)")))
                    #label($labelText, $labelColor, 56, 28)
#else
    &nbsp;
#end
                </entry>
            </row>
        </tbody>
    </tgroup>
</table>
#end
