## load macros from other files
#parse("META-INF/templates/en/labels-vulnerability-assessment/macros/labels.vm")
#parse("META-INF/templates/en/inventory-report-vulnerability/macros/inventory-report-assets.vm")
##
## main template content
<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "http://docs.oasis-open.org/dita/v1.1/OS/dtd/topic.dtd">
<topic id="tpc_vulnerability-assets-$reportContext.id">
    <title>$reportContext.combinedTitle("Affected Assets", true)</title>

    #set($assets = $assetAdapter.listAssets())
    #set($atLeastOneAssetWithDetails = false)

    <body>
    #if(!$assets.isEmpty())
        #foreach($asset in $assets)
            #set($assetName = $asset.get("Name"))
            #set($artifacts = $assetAdapter.getRelatedArtifacts($asset))
            #if(!$artifacts.isEmpty())
                #foreach($artifact in $artifacts)
                    #set($vulnerabilitiesForComponent = $vulnerabilityAdapter.getVulnerabilitiesForComponent($artifact.getComponent()))
                    #if(!$vulnerabilitiesForComponent.isEmpty())
                        #set($atLeastOneAssetWithDetails = true)
                        #componentsInAffectedAssetTable($artifact $assetName)
                    #end
                #end
            #end
        #end
    #elseif(!$atLeastOneAssetWithDetails)
        <p>There are no Assets containing components with vulnerabilities.</p>
    #else
        <p>No affected assets have been identified.</p>
    #end
    </body>
</topic>
