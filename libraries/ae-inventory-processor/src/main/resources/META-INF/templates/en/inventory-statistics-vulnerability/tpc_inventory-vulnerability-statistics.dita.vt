#parse("META-INF/templates/en/labels-vulnerability-assessment/macros/labels.vm")
#parse("META-INF/templates/en/inventory-report-vulnerability/macros/inventory-report-vulnerabilities.vm")
<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "http://docs.oasis-open.org/dita/v1.1/OS/dtd/topic.dtd">
<topic id="tpc_vulnerability-summary-$reportContext.id">
    <title>$reportContext.combinedTitle("Vulnerability Statistics", true)</title>
##
    #set ($vulnerabilities = $vulnerabilityAdapter.getEffectiveVulnerabilitiesAll())
    #set ($initialVulnerabilities = $vulnerabilityAdapter.getEffectiveVulnerabilitiesInitialInventoryAll())
    #set($lang = $utils.getLanguagePropertyFile())
##
    <body>
        <p id="statistics-preface"> $lang.get("inventory-statistics-vulnerability.statistics-preface")</p>
        <p id="statistics-table">
#statisticsOverviewTable("vulnerabilities_statistics_table_unmodified_all", "Vulnerability Statistics$reportContext.inContextOf()", $initialVulnerabilities, "", false)
        </p>


## iterate over all advisories that shall have their own overview table
#foreach($advisory in $report.getGenerateOverviewTablesForAdvisories())
    #set ($advisoryName = $advisory.getWellFormedName())
    #set ($advisoryIdentifier = $advisory.name())
##
        <p id="statistics-preface-$advisoryIdentifier">$lang.get("inventory-statistics-vulnerability.statistics-for-vulnerability") </p>
        <p id="statistics-table-$advisoryIdentifier">
#statisticsOverviewTable("vulnerabilities_statistics_table_unmodified_$report.xmlEscapeStringAttribute($advisoryIdentifier.toLowerCase())", "Vulnerability Statistics with $report.xmlEscapeString($advisoryName) Advisories$reportContext.inContextOf()", $initialVulnerabilities, $advisory, false)
        </p>
#end


        <p id="statistics-preface-modified">$lang.get("inventory-statistics-vulnerability.statistics-preface-modified")</p>
        <p id="statistics-table-modified">
#statisticsOverviewTable("vulnerabilities_statistics_table_modified_all", "Context Vulnerability Statistics$reportContext.inContextOf()", $vulnerabilities, "", true)
        </p>


## iterate over all advisories that shall have their own modified overview table
#foreach($advisory in $report.getGenerateOverviewTablesForAdvisories())
    #set ($advisoryName = $advisory.getWellFormedName())
    #set ($advisoryIdentifier = $advisory.name())
##
        <p id="statistics-preface-modified-$advisoryIdentifier">$lang.get("inventory-statistics-vulnerability.statistics-preface-modified-with-advisory")</p>
        <p id="statistics-table-modified-$advisoryIdentifier">
#statisticsOverviewTable("vulnerabilities_statistics_table_modified_$report.xmlEscapeStringAttribute($advisoryIdentifier.toLowerCase())", "Context Vulnerability Statistics with $report.xmlEscapeString($advisoryName) Advisories$reportContext.inContextOf()", $vulnerabilities, $advisory, true)
        </p>
#end
    <p id="statistics-preface-modified-KEV">$lang.get("inventory-statistics-vulnerability.statistics-preface-modified-KEV")</p>
    <p>
        <table>
            <title>CISA KEV vulnerabilities statistics</title>
            <tgroup cols="3">
                <colspec colname="COLSPEC0" colnum="1" colwidth="1*" valign="middle"/>
                <colspec colname="COLSPEC1" colnum="2" colwidth="1*" valign="middle"/>
                <colspec colname="COLSPEC2" colnum="3" colwidth="1*" valign="middle"/>
                <thead>
                <row>
                    <entry>Exploited in the Wild</entry>
                    <entry>Total</entry>
                    <entry>Percentage</entry>
                </row>
                </thead>
                <tbody>
                <row>
                    <entry>KNOWN</entry>
                    <entry>$vulnerabilityAdapter.totalOfKevEntries()</entry>
                    <entry>$vulnerabilityAdapter.percentageOfKev()%</entry>
                </row>
                <row>
                    <entry>UNKNOWN</entry>
                    <entry>$vulnerabilityAdapter.totalOfNotKevEntries()</entry>
                    <entry>$vulnerabilityAdapter.percentageOfNotKev()%</entry>
                </row>
                </tbody>
            </tgroup>
        </table>
    </p>
    </body>
</topic>
