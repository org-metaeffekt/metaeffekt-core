## load macros from other files
#parse("META-INF/templates/en/labels-vulnerability-assessment/macros/labels.vm")
#parse("META-INF/templates/en/inventory-report-vulnerability/macros/inventory-report-vulnerabilities.vm")
##
## main template content
<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "http://docs.oasis-open.org/dita/v1.1/OS/dtd/topic.dtd">
<topic id="tpc_vulnerability-summary-$reportContext.id">
    <title>$reportContext.combinedTitle("Vulnerability List", true)</title>
##
#set ($vulnerabilities = $vulnerabilityAdapter.getEffectiveVulnerabilitiesAll())
##
#set ($vulnerabilitiesByStatus = $vulnerabilityAdapter.getVulnerabilitiesByEffectiveStatus($vulnerabilities)) ## Map<DisplayStatusData, List<AeaaVulnerability>> getVulnerabilitiesByEffectiveStatus(List<AeaaVulnerability> vulnerabilities)
#set ($isAnyCategoryDefined = false)
#foreach ($status in $vulnerabilitiesByStatus.keySet())
    #if ($vulnerabilitiesByStatus.get($status).size() > 0)
        #set ($isAnyCategoryDefined = true)
    #end
#end
##
    <body>
#if(!$isAnyCategoryDefined)
        <p>
            No vulnerabilities have been identified.
        </p>
#else
        <p>
            The following vulnerabilities have been identified and categorized.
        </p>

#foreach ($status in $vulnerabilitiesByStatus.keySet())
    #if ($vulnerabilitiesByStatus.get($status).size() > 0)
        <topic id="tpc_vulnerability-summary-${reportContext.id}-$status.getAsXmlId()">
            <title>$status.getCapitalized()</title>
            <body>
        <p>
            The following vulnerabilities are considered <codeph>$status.getCapitalized()</codeph> within the given configuration:
        </p>
        <p>
#vulnerabilityOverview($status.getAsXmlId(), "$report.xmlEscapeString($status.getCapitalized()) Category$reportContext.inContextOf()", $vulnerabilitiesByStatus.get($status), $status.shouldModifiedCvssBeDisplayed())
        </p>
            </body>
        </topic>
    #else
        <topic id="tpc_vulnerability-summary-${reportContext.id}-$status.getAsXmlId()">
            <title>$status.getCapitalized()</title>
            <body>
        <p>
            No vulnerabilities are considered <codeph>$report.xmlEscapeString($status.getCapitalized())</codeph> within the given configuration.
        </p>
            </body>
        </topic>
    #end
#end
#end
    </body>
</topic>
