## load macros from other files
#parse("META-INF/templates/en/labels-vulnerability-assessment/macros/labels.vm")
#parse("META-INF/templates/en/inventory-report-vulnerability/macros/inventory-report-vulnerabilities.vm")
##
## main template content
<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "http://docs.oasis-open.org/dita/v1.1/OS/dtd/topic.dtd">
<topic id="tpc_vulnerability-components-$reportContext.id">
    <title>$reportContext.combinedTitle("Components", true)</title>
    ##
    #set($cvssScoringPreference=$report.getCvssScoringPreference())
    #set($components = $vulnerabilityAdapter.getComponentsFromInventory())
    ##
    <body>
        #foreach($component in $components)

        <section id="component-$component">
            <title>$component</title>
            <body>

                ## section for artifacts with component
                #set($artifacts = $vulnerabilityAdapter.getArtifactsForComponent($component))
                #if(!$artifacts.isEmpty())
                <section>
                    <title>Artifacts</title>
                    <body>
                        #set($title = "${component} Affected Artifacts")
                        #affectedComponentsTable("", $artifacts, $title)
                    </body>
                </section>
                #end

                ## section with vulnerabilities for component
                #set($vulnerabilitiesForComponent = $vulnerabilityAdapter.getVulnerabilitiesForComponent($component))
                #set($vulnerabilitiesForComponent = $vulnerabilityAdapter.sortVulnerabilitiesByUnmodifiedCvssScore($vulnerabilitiesForComponent, $cvssScoringPreference))
                #if(!$vulnerabilitiesForComponent.isEmpty())
                <section>
                    <title>Vulnerabilities</title>
                    <body>
                        #vulnerabilityOverview(
                            "${component}_vulnerabilities", "${component} Vulnerabilities",
                            $vulnerabilitiesForComponent, true
                        )
                    </body>
                </section>
                #end

            </body>
        </section>

        #end
    </body>
</topic>
