## load macros from other files
#parse("META-INF/templates/en/labels-vulnerability-assessment/macros/labels.vm")
#parse("META-INF/templates/en/inventory-report-vulnerability/macros/inventory-report-vulnerabilities-abstracted.vm")
##
## main template content
<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "http://docs.oasis-open.org/dita/v1.1/OS/dtd/topic.dtd">
<topic id="tpc_vulnerability-summary-$reportContext.id">
    <title>$reportContext.combinedTitle("Vulnerability List", true)</title>
##
#set($threshold=$report.getVulnerabilityScoreThreshold())
#set($cvssScoringPreference=$report.getCvssScoringPreference())
##
#set($vulnerabilitiesAffected=$vulnerabilityAdapter.collectAffectedCategory())
#set($vulnerabilitiesPotentiallyAffected=$vulnerabilityAdapter.collectPotentiallyAffectedCategory($threshold))
#set($vulnerabilitiesNotAffected=$vulnerabilityAdapter.collectNotAffectedCategory())
##
    <body>
#if($vulnerabilitiesAffected.isEmpty() && $vulnerabilitiesPotentiallyAffected.isEmpty() && $vulnerabilitiesNotAffected.isEmpty())
        <p>
            No vulnerabilities have been identified.
        </p>
#else
        <p>
            The following vulnerabilities have been identified and categorized.
        </p>

        <section>
            <title>Affected</title>
            <body>
#if($vulnerabilitiesAffected.isEmpty())
        <p>
            No vulnerabilities that affect the software in scope have been identified.
        </p>
#else
#set($vulnerabilities=$vulnerabilityAdapter.sortVulnerabilitiesByUnmodifiedCvssScore($vulnerabilitiesAffected, $cvssScoringPreference))
        <p>
            The following vulnerabilities may affect the software in scope:
#vulnerabilityOverview("affected", "Affected Category$reportContext.inContextOf()", $vulnerabilities, true, $threshold)
        </p>
#end
        </body>
        </section>

        <section>
            <title>Potentially Affected</title>
            <body>
#if($vulnerabilitiesPotentiallyAffected.isEmpty())
            <p>
                No vulnerabilities that potentially affect the software in scope have been identified.
            </p>
#else
#set($vulnerabilities=$vulnerabilityAdapter.sortVulnerabilitiesByUnmodifiedCvssScore($vulnerabilitiesPotentiallyAffected, $cvssScoringPreference))
        <p>
            The following vulnerabilities have not been fully assessed for the software in scope:
#vulnerabilityOverview("potentially_affected", "Potentially Affected Category$reportContext.inContextOf()", $vulnerabilities, true, $threshold)
        </p>
#end
        </body>
        </section>

        <section>
            <title>Not Affected</title>
            <body>
#if($vulnerabilitiesNotAffected.isEmpty())
        <p>
            For the software in scope no vulnerabilities have been identified in this category.
        </p>
#else
#set($vulnerabilities=$vulnerabilityAdapter.sortVulnerabilitiesByUnmodifiedCvssScore($vulnerabilitiesNotAffected, $cvssScoringPreference))
        <p>
            The following vulnerabilities are not considered of relevance in the given context:
        </p>
        <p>
#vulnerabilityOverview("not_affected", "Not Affected Category$reportContext.inContextOf()", $vulnerabilities, false, $threshold)
        </p>
#end
        </body>
        </section>
#end
    </body>
</topic>
