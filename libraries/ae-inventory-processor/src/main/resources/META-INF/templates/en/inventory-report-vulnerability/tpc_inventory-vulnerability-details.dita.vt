#parse("META-INF/templates/en/inventory-report-vulnerability/macros/inventory-report-labels.vm")
#parse("META-INF/templates/en/inventory-report-vulnerability/macros/inventory-report-vulnerabilities.vm")
<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "http://docs.oasis-open.org/dita/v1.1/OS/dtd/topic.dtd">
<topic id="tpc_vulnerability-summary-$reportContext.id">
    <title>$reportContext.combinedTitle("Vulnerability Details", true)</title>
#set($threshold=$report.getVulnerabilityScoreThreshold())
#set($vulnerabilities=$vulnerabilityAdapter.getVulnerabilityMetaDataForDetailReport($threshold))
#if($vulnerabilities.isEmpty())
    <body>
        <p>
            No vulnerabilities have been identified.
        </p>
    </body>
#else
    <body>
        <p>
            Details are provided for vulnerabilities which are either potential vulnerabilities or which have
            third-party advisories.
        </p>
    </body>
#foreach($vulnerability in $vulnerabilities)
#set($vulnerabilityName=$vulnerability.get("Name"))
#set($advisories=$vulnerabilityAdapter.getAdvisories($vulnerability))
#set($alerts=$vulnerabilityAdapter.filterType($advisories, "alert"))
#set($notices=$vulnerabilityAdapter.filterType($advisories, "notice"))
#set($news=$vulnerabilityAdapter.filterType($advisories, "news"))
    <topic id="$vulnerabilityName">
        <title>$vulnerabilityName</title>
        <body>

            <section>
                <title>Affected Components</title>
                <body>
                    #set($affectedComponents=$vulnerabilityAdapter.getAffectedComponents($vulnerability))
                    #affectedComponentsTable($vulnerability, $affectedComponents)
                </body>
            </section>

            <section>
                <title>Description</title>
                <body>
                    $report.xmlEscapePreformattedContentString($vulnerability.get("Description"))
                    #referenceTable("${vulnerabilityName}_ref", "$vulnerabilityName References", $vulnerability)
                </body>
            </section>

#if ($vulnerability.get("Weakness"))
            <section>
                <title>Weakness</title>
                <body>
                    $report.xmlEscapePreformattedContentString($vulnerability.get("Weakness"))
                </body>
            </section>
#end
            <section>
                <title>Severity</title>
                <body>
                    <p>
                        #severityDetails("${vulnerabilityName}_severity", "$vulnerabilityName Severity", $vulnerability)
                    </p>
                    #severityChartUnmodified("${vulnerabilityName}_unmodified_severity_charts", "$vulnerabilityName Severity Details", $vulnerability)
                </body>
            </section>

        </body>
        <topic id="${vulnerabilityName}-advisories">
            <title>Advisories</title>
            <body>
#if ($alerts.isEmpty() && $notices.isEmpty() && $news.isEmpty())
                <p>
                    No advisories have been identified.
                </p>
#end
#if (!$alerts.isEmpty())
            <section>
                <title>Alerts</title>
                <p>
#advisoryOverview("${vulnerabilityName}_alerts", "$vulnerabilityName Alerts", $alerts)
                </p>
            </section>
#end
#if (!$notices.isEmpty())
            <section>
                <title>Notices</title>
                <p>
#advisoryOverview("${vulnerabilityName}_notices", "$vulnerabilityName Notices", $notices)
                </p>
            </section>
#end
#if (!$news.isEmpty())
            <section>
                <title>Updates</title>
                <p>
#advisoryOverview("${vulnerabilityName}_updates", "$vulnerabilityName Updates", $news)
                </p>
            </section>
#end
            </body>
        </topic>
        <topic id="$vulnerability.get("Name")-assessment">
            <title>Assessment</title>
            <body>

                <p>
                    #if ($vulnerabilityAdapter.isPotentialVulnerability($vulnerability))
                        #labelRef("Potential Vulnerability")
                    #end
                    #if ($vulnerability.get("CVSS Modified Severity (max)"))
                        #labelRef($vulnerability.get("CVSS Modified Severity (max)"))
                    #else
                        #if ($vulnerability.get("CVSS Unmodified Severity (max)"))
                            #labelRef($vulnerability.get("CVSS Unmodified Severity (max)"))
                        #end
                    #end
                    #if ($vulnerabilityAdapter.isReviewedVulnerability($vulnerability))
                        #labelRef("Reviewed")
                    #end
                    #if ($vulnerabilityAdapter.isInReviewVulnerability($vulnerability))
                        #labelRef("In Review")
                    #end
                </p>

                <section>
                    <title>Modified Severity</title>
                    <body>
                        <p>
                            #severityDetailsModified("${vulnerabilityName}_modified_severity", "$vulnerabilityName Modified Severity", $vulnerability)
                        </p>
                        #severityChartModified("${vulnerabilityName}_modified_severity_charts", "$vulnerabilityName Modified Severity Details", $vulnerability)
                    </body>
                </section>

#if ($vulnerability.get("Rationale"))
                <section>
                    <title>Rationale</title>
                    <body>
                        $report.xmlEscapePreformattedContentString($vulnerability.get("Rationale"))
                    </body>
                </section>
#end

#if ($vulnerability.get("Risk"))
                <section>
                    <title>Risk</title>
                    <body>
                        $report.xmlEscapePreformattedContentString($vulnerability.get("Risk"))
                    </body>
                </section>
#end

#if ($vulnerability.get("Measures"))
                <section>
                    <title>Measures</title>
                    <body>
                        $report.xmlEscapePreformattedContentString($vulnerability.get("Measures"))
                    </body>
                </section>
#end

            </body>
        </topic>
    </topic>
#end
#end
</topic>
