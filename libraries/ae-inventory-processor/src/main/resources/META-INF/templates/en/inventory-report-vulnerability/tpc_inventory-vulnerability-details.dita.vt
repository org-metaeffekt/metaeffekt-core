<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "http://docs.oasis-open.org/dita/v1.1/OS/dtd/topic.dtd">
<topic id="tpc_vulnerability-summary-$reportContext.id" xmlns:ditaarch="http://dita.oasis-open.org/architecture/2005/">
    <title>$reportContext.combinedTitle("Vulnerability Details", true)</title>
#set($threshold=$report.getVulnerabilityScoreThreshold())
#set($vulnerabilities=$vulnerabilityAdapter.getVulnerabilityMetaDataForDetailReport($threshold))
    <body>
#if($vulnerabilities.isEmpty())
        <p>
            No vulnerabilities have been identified.
        </p>
#else
        <p>
            Details are provided for vulnerabilities which are either potential vulnerabilities or which have
            third-party advisories.
        </p>
    </body>
#foreach($vulnerability in $vulnerabilities)
    <topic id="$vulnerability.get("Name")">
        <title>$vulnerability.get("Name")</title>
        <body>
            <section>
                <title>Severity</title>
                <body>
                    <p>
                    <svg-container><svg:svg xmlns:svg="http://www.w3.org/2000/svg" width="60px" height="20px">
                       <svg:rect x="0" y="0" rx="3" ry="3" width="60" height="20" style="fill:red" />
                       <svg:text text-anchor="middle" alignment-baseline="central" fill="white">
                           <svg:tspan x="30" y="14" font-weight="bold">$vulnerability.get("CVSS Severity")</svg:tspan>
                       </svg:text>
                    </svg:svg></svg-container>
                    </p>

                    <p>CVSS (v2) Score : $vulnerability.get("CVSS Score (v2)")</p>
                    <p>CVSS Vector (v2): <codeph>$report.xmlEscapePreformattedContentString($vulnerability.get("CVSS Vector (v2)"))</codeph></p>
                    <p>CVSS (v3) Score: $vulnerability.get("CVSS Base Score (v3)")</p>
                    <p>CVSS Vector (v3): <codeph>$report.xmlEscapePreformattedContentString($vulnerability.get("CVSS Vector (v3)"))</codeph></p>
                </body>
            </section>

            <section>
                <title>Description</title>
                <body>
                    $report.xmlEscapePreformattedContentString($vulnerability.get("Description"))
                </body>
            </section>

            <section>
                <title>Weakness</title>
                <body>
                    $report.xmlEscapePreformattedContentString($vulnerability.get("Weakness"))
                </body>
            </section>

            <section>
                <title>References</title>
                <body>
                    NVD: <xref href="$report.xmlEscapePreformattedContentString($vulnerability.get("Url"))" type="html" scope="external" />
                </body>
            </section>
        </body>
        <topic id="$vulnerability.get("Name")-advisories">
            <title>Alerts / Advisories / Updates</title>
            <body>
                <section>
                    <title>Alerts</title>
#foreach($advisory in $vulnerabilityAdapter.filterType($vulnerabilityAdapter.getAdvisories($vulnerability), "alert"))
                    <p>
                        $advisory.id
                        $report.xmlEscapePreformattedContentString($advisory.overview)
                    </p>
#end
                </section>
                <section>
                    <title>Advisories</title>
#foreach($advisory in $vulnerabilityAdapter.filterType($vulnerabilityAdapter.getAdvisories($vulnerability), "notice"))
                    <p>
                        $advisory.id
                        $report.xmlEscapePreformattedContentString($advisory.overview)
                    </p>
#end
                </section>
                <section>
                    <title>Updates</title>
#foreach($advisory in $vulnerabilityAdapter.filterType($vulnerabilityAdapter.getAdvisories($vulnerability), "news"))
                    <p>
                        $advisory.id
                        $report.xmlEscapePreformattedContentString($advisory.overview)
                    </p>
#end
                </section>
            </body>
        </topic>
        <topic id="$vulnerability.get("Name")-assessment">
            <title>Assessment</title>
            <body>
                <section>
                    <title>Applicability</title>
                    <body>
                        <p>Status: $report.xmlEscapePreformattedContentString($vulnerability.get("Status"))</p>
                        <p>$report.xmlEscapePreformattedContentString($vulnerability.get("Rationale"))</p>
                    </body>
                </section>

                <section>
                    <title>Risk</title>
                    <body>
                        $report.xmlEscapePreformattedContentString($vulnerability.get("Risk"))
                    </body>
                </section>

                <section>
                    <title>Measures</title>
                    <body>
                        $report.xmlEscapePreformattedContentString($vulnerability.get("Measures"))
                    </body>
                </section>
            </body>
        </topic>
    </topic>
#end
#end
</topic>
