## load macros from other files
#parse("META-INF/templates/labels-vulnerability-assessment/macros/labels.vm")
#parse("META-INF/templates/inventory-report-vulnerability/macros/inventory-report-vulnerabilities.vm")
##
## main template content
<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "http://docs.oasis-open.org/dita/v1.1/OS/dtd/topic.dtd">
<topic id="tpc_vulnerability-summary-$reportContext.id">
    <title>$reportContext.combinedTitle("Vulnerability List", true)</title>
##
#set ($vulnerabilities = $vulnerabilityAdapter.getEffectiveVulnerabilitiesAll())

##
#set ($vulnerabilitiesByStatus = $vulnerabilityAdapter.getVulnerabilitiesByEffectiveStatus($vulnerabilities)) ## Map<DisplayStatusData, List<AeaaVulnerability>> getVulnerabilitiesByEffectiveStatus(List<AeaaVulnerability> vulnerabilities)
#set ($isAnyCategoryDefined = false)
#foreach ($status in $vulnerabilitiesByStatus.keySet())
    #if ($vulnerabilitiesByStatus.get($status).size() > 0)
        #set ($isAnyCategoryDefined = true)
    #end
#end
##
    <body>
#if(!$isAnyCategoryDefined)
        <p>$utils.getText("general.no-vulnerabilites")</p>
#else
        <p>$utils.getText("inventory-report-vulnerability.defined-vulnerabilites")</p>

#foreach ($status in $vulnerabilitiesByStatus.keySet())
    #if ($vulnerabilitiesByStatus.get($status).size() > 0)
        <topic id="tpc_vulnerability-summary-${reportContext.id}-$status.getAsXmlId()">
            <title>$status.getCapitalized()</title>
            <body>
        <p>$utils.getText("inventory-report-vulnerability.vulnerability-status")</p>
        <p>
#vulnerabilityOverview($status.getAsXmlId(), "$report.xmlEscapeString($status.getCapitalized()) Category$reportContext.withTitle()", $vulnerabilitiesByStatus.get($status), $status.shouldModifiedCvssBeDisplayed())
        </p>
            </body>
        </topic>
    #else
        <topic id="tpc_vulnerability-summary-${reportContext.id}-$status.getAsXmlId()">
            <title>$status.getCapitalized()</title>
            <body>
        <p>$utils.getText("inventory-report-vulnerability.vulnerability-no-status")</p>
            </body>
        </topic>
    #end
#end
#end
    </body>
</topic>
