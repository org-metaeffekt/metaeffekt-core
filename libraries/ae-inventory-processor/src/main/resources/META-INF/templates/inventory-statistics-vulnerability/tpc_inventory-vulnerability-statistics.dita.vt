#parse("META-INF/templates/labels-vulnerability-assessment/macros/labels.vm")
#parse("META-INF/templates/inventory-report-vulnerability/macros/inventory-report-vulnerabilities.vm")
<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "http://docs.oasis-open.org/dita/v1.1/OS/dtd/topic.dtd">
<topic id="tpc_vulnerability-summary-$reportContext.id">
    <title>$reportContext.combinedTitle("Vulnerability Statistics", true)</title>
##
    #set ($vulnerabilities = $vulnerabilityAdapter.getEffectiveVulnerabilitiesAll())
    #set ($initialVulnerabilities = $vulnerabilityAdapter.getEffectiveVulnerabilitiesInitialInventoryAll())
##
    <body>
        <p id="statistics-preface">$utils.getText("inventory-statistics-vulnerability.statistics-preface")</p>
        <p id="statistics-table">
            #statisticsOverviewTable("vulnerabilities_statistics_table_unmodified_all", $utils.getText("inventory-report-vulnerability.short.vuln-statistics"), $initialVulnerabilities, "", false)
        </p>


## iterate over all advisories that shall have their own overview table
#foreach($advisory in $report.getSecurityPolicy().getGenerateOverviewTablesForAdvisoriesInst())
    #set ($advisoryName = $advisory.getWellFormedName())
    #set ($advisoryIdentifier = $advisory.name())
##
        <p id="statistics-preface-$advisoryIdentifier">$utils.getText("inventory-statistics-vulnerability.statistics-for-vulnerability")</p>
        <p id="statistics-table-$advisoryIdentifier">
#statisticsOverviewTable("vulnerabilities_statistics_table_unmodified_$report.xmlEscapeStringAttribute($advisoryIdentifier.toLowerCase())", $utils.getText("inventory-report-vulnerability.vuln-statistics"), $initialVulnerabilities, $advisory, false)
        </p>
#end


        <p id="statistics-preface-modified">$utils.getText("inventory-statistics-vulnerability.statistics-preface-modified")</p>
        <p id="statistics-table-modified">
#statisticsOverviewTable("vulnerabilities_statistics_table_modified_all", $utils.getText("inventory-report-vulnerability.short.context-vuln-statistics"), $vulnerabilities, "", true)
        </p>


## iterate over all advisories that shall have their own modified overview table
#foreach($advisory in $report.getSecurityPolicy().getGenerateOverviewTablesForAdvisoriesInst())
    #set ($advisoryName = $advisory.getWellFormedName())
    #set ($advisoryIdentifier = $advisory.name())
##
        <p id="statistics-preface-modified-$advisoryIdentifier">$utils.getText("inventory-statistics-vulnerability.statistics-preface-modified-with-advisory")</p>
        <p id="statistics-table-modified-$advisoryIdentifier">
#statisticsOverviewTable("vulnerabilities_statistics_table_modified_$report.xmlEscapeStringAttribute($advisoryIdentifier.toLowerCase())", $utils.getText("inventory-report-vulnerability.context-vuln-statistics"), $vulnerabilities, $advisory, true)
        </p>
#end
    <p id="statistics-preface-modified-KEV">$utils.getText("inventory-statistics-vulnerability.statistics-preface-modified-KEV")</p>
    <p>
        <table>
            <title>$utils.getText("inventory-report-vulnerability.cisa-kev")</title>
            <tgroup cols="3">
                <colspec colname="COLSPEC0" colnum="1" colwidth="1*" align="left"/>
                <colspec colname="COLSPEC1" colnum="2" colwidth="1*" align="right"/>
                <colspec colname="COLSPEC2" colnum="3" colwidth="1*" align="right"/>
                <thead>
                    <row valign="middle">
                        <entry>$utils.getText("inventory-report-vulnerability.short.exploited-in-the-wild")</entry>
                        <entry>$utils.getText("general.short.total")</entry>
                        <entry>$utils.getText("general.short.percentage")</entry>
                    </row>
                </thead>
                <tbody>
                <row valign="middle">
                    <entry>$utils.getText("inventory-report-vulnerability.short.known")</entry>
                    <entry>$vulnerabilityAdapter.totalOfKevEntries()</entry>
                    <entry>$vulnerabilityAdapter.percentageOfKev()%</entry>
                </row>
                <row valign="middle">
                    <entry>$utils.getText("inventory-report-vulnerability.short.unknown")</entry>
                    <entry>$vulnerabilityAdapter.totalOfNotKevEntries()</entry>
                    <entry>$vulnerabilityAdapter.percentageOfNotKev()%</entry>
                </row>
                </tbody>
            </tgroup>
        </table>
    </p>
    </body>
</topic>
